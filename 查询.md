## Making queries（进行查询）

创建数据模型后，Django会自动为您提供一个数据库抽象API，该API可让您创建，检索，更新和删除对象。

保存：save()

删除：delete()

要从数据库检索对象，请通过模型类上的Manager构造QuerySet。

QuerySet表示数据库中对象的集合。它可以有零个，一个或多个过滤器。过滤器根据给定的参数缩小查询结果的范围。用SQL术语来说，QuerySet等同于SELECT语句，而过滤器是一个限制子句，例如WHERE或LIMIT。

您可以通过使用模型的Manager获得QuerySet。每个模型都有至少一个Manager，默认情况下称为对象。

管理者只能通过模型类来访问，而不是通过模型实例来访问，以实现 "表级 "操作和 "记录级 "操作的分离。

以下记录常用查询命令：

```python
# 查询所有数据
model_name.objects.all()
# 过滤器检索，filter和exclude
# 可以使用链式查找，返回的都是QuerySet
Entry.objects.filter(headline__startswith='What')
.exclude(pub_date__gte=datetime.date.today())
.filter(pub_date__gte=datetime.date(2005, 1, 30)
# get方法获取单一的QuerySet对象
```

QuerySets是懒惰的
QuerySets是懒惰的--创建一个QuerySet的行为不涉及任何数据库活动。你可以整天把过滤器堆叠在一起，而Django不会真正运行查询，直到QuerySet被评估后才会运行。看一下这个例子。

QuerySerts也可以使用切片方法。

字段查询
字段查找是您如何指定SQL WHERE子句的内容。它们被指定为QuerySet方法filter（），exclude（）和get（）的关键字参数。

基本lookups关键字参数的格式为field__lookuptype = value。 （这是双下划线）。

但有一个例外，如果是ForeignKey，你可以指定以_id作为后缀的字段名。

### 双下划线可匹配的字段：

+ exact：完全匹配
+ contains：区分大小写的模糊匹配
+ startwith，endwith：以xx开始结束
+ 前面加i表示不区分大小写。

### 跨关系查询

```python
# 这个例子检索所有Entry与对象Blog，其name 为：'Beatles Blog'
Entry.objects.filter(blog__name='Beatles Blog')
# 这个例子检索所有Blog具有至少一个对象Entry ，其headline包含'Lennon'：
Blog.objects.filter(entry__headline__contains='Lennon')
# 

```

跨多值查询：

### Q对象和F对象的使用：

关键字参数查询（在filter（）等中）一起“与”在一起。如果需要执行更复杂的查询（例如，带有OR语句的查询），则可以使用Q对象。

Q对象（django.db.models.Q）是用于封装关键字参数集合的对象。这些关键字参数在上面的“字段查找”中指定。

例如，此Q对象封装了一个LIKE查询：

```python
Q(question__startswith='What')
# 可以使用＆和|组合Q对象。操作员。在两个Q对象上使用运算符时，将产生一个新的Q对象。
```

### 删除对象

删除方法方便地命名为 [`delete()`](https://docs.djangoproject.com/en/3.0/ref/models/instances/#django.db.models.Model.delete)。此方法立即删除对象，并返回删除的对象数和带有每种对象类型的删除数的字典。例

```
>>> e.delete()
(1, {'weblog.Entry': 1})

```

### 复制模型实例

### 更新数据

### queryset的缓存机制

querySet可以保存起来重复，或者链式使用。

反复在queryset对象中获取某个索引将每次都查询数据库

```
>>> queryset = Entry.objects.all()
>>> print(queryset[5]) # Queries the database
>>> print(queryset[5]) # Queries the database again
```

但是，如果已经评估了整个查询集，则将检查缓存：

```
>>> queryset = Entry.objects.all()
>>> [entry for entry in queryset] # Queries the database
>>> print(queryset[5]) # Uses cache
>>> print(queryset[5]) # Uses cache
```

（简单地打印查询集不会填充缓存。这是因为对__repr __（）的调用仅返回整个查询集的一部分。）

### 一对多关系

### 一些其他方法：

+ add
+ create
+ clear
+ set

### 多对多关系